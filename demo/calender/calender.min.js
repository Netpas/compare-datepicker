"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),dateComponent=function(){function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".cus-date",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var l in n)i[l]||(i[l]=n[l]);o=i,u=a,o.originDate.length<2&&(o.originDate=[c(new Date)-5184e5,c(new Date)]),o.origin_Date=[s(o.originDate[0]),s(o.originDate[1])],r={origin_start_Date:new t(""+o.origin_Date[0]),origin_end_Date:new t(""+o.origin_Date[1]),compare_start_Date:new t(""+o.compare_Date[0]),compare_end_Date:new t(""+o.compare_Date[1])},e.prototype.init()}var t=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";_classCallCheck(this,e),this.data=t,this.nodes=[]}return _createClass(e,[{key:"bindTo",value:function(e){this.nodes.push(e),this.update()}},{key:"update",value:function(){for(var e,t=["INPUT","TEXTAREA"],a=this.nodes,n=0;e=a[n++];)t.includes(e.nodeName)?e.value!==this.data&&(e.value=this.data):e.textContent=this.data}},{key:"set",value:function(e){e!==this.value&&(this.data=e,this.update())}},{key:"get",value:function(){return this.data}}]),e}(),a={$emit:function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];this.eventList[e].forEach(function(e,t,n){e.callback(a),e.once&&n.splice(t,1)})},on:function(e,t,a){this.eventList[e]||(this.eventList[e]=[]);var n={callback:t};a&&(n.once=!0),this.eventList[e].push(n)},once:function(e,t){this.on(e,t,!0)},off:function(e,t){if(e)if(t){var a=this.eventList[e].indexOf(t);this.eventList[e].splice(a,1)}else this.eventList[e]=[];else this.eventList={}},eventList:{}},n={week:"zh",divider:"/",cusCompareShow:!0,OriginQuicky:[],origin_Date:[],compare_Date:[],originDate:[],compareDate:[],start_cycle:0,is_compare:!1},c=function(e){return new Date(new Date(e).setHours(0,0,0,0)).getTime()},s=function(e,t){if(0===arguments.length)return null;var a=t||"{y}-{m}-{d}",n=void 0;"object"===(void 0===e?"undefined":_typeof(e))?n=e:(10===(""+e).length&&(e=1e3*parseInt(e)),n=new Date(e));var c={y:n.getFullYear(),m:n.getMonth()+1,d:n.getDate(),h:n.getHours(),i:n.getMinutes(),s:n.getSeconds(),a:n.getDay()};return a.replace(/{(y|m|d|h|i|s|a)+}/g,function(e,t){var a=c[t];return"a"===t?["一","二","三","四","五","六","日"][a-1]:(e.length>0&&a<10&&(a="0"+a),a||0)})},i={zh:["日","一","二","三","四","五","六"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},r={},o={},u=void 0;return e.prototype={init:function(){this.cusCreateNeedElem(),this.cusBindEvent()},cusCreateNeedElem:function(){var e=this,t='\n                <div class="cus-calender-wrapper">\n                    <div class="cus-show-calender">\n                        <div class="cus-origin-date">\n                            <input type="text" cus-data-bind="origin_start_Date" id="cusOriginStartDate"/>\n                            <i>'+o.divider+'</i>\n                            <input type="text" cus-data-bind="origin_end_Date"  id="cusOriginEndDate"/>\n                        </div>\n                    </div>\n                    <div class="cus-calender-panel cus-clearFix" style="display: none;">\n                        <div class="cus-clearFix">\n                            <div class="cus-quicky-key"></div>\n                            <div class="cus-panel-body cus-clearFix"></div>\n                            <div class="cus-panel-footer cus-clearFix"></div>\n                        </div>\n                    </div>\n                </div> ';document.querySelector(u)&&(document.querySelector(u).innerHTML=t),this.cusQuickyKey(o);var a=this.cusGetElemenet({id_Name:"cusOriginStartDate"}),n=this.cusGetElemenet({id_Name:"cusOriginEndDate"});a.focus(),r[a.getAttribute("cus-data-bind")].bindTo(a),r[n.getAttribute("cus-data-bind")].bindTo(n),o.cusCompareShow&&(this.cusGetElemenet({query_Selector:".cus-panel-footer"}).innerHTML+='\n                <div class="cus-compare-panel">\n                    <label for="compare-panel-input-show">\n                        <input type="checkbox" id="compare-panel-input-show">\n                        比较日期范围\n                    </label>\n                </div>\n            '),a.addEventListener("input",function(){r[this.getAttribute("cus-data-bind")].set(this.value)}),a.addEventListener("keyup",function(t){"13"==t.keyCode&&e.setOriginDate(a.value,0)}),n.addEventListener("input",function(){r[this.getAttribute("cus-data-bind")].set(this.value)}),n.addEventListener("keyup",function(t){"13"==t.keyCode&&e.setOriginDate(n.value,1)}),a&&a.addEventListener("focus",function(e){o.start_cycle=0}),n&&n.addEventListener("focus",function(e){o.start_cycle=1}),this.cusDrawCalender(o.origin_Date[1].split("-")[0],o.origin_Date[1].split("-")[1])},cusSelectedTime:function(){for(var e=this.cusGetElemenet({class_Name:"cus-calender-body"}),t=0;t<e.length;t++)if(!this.cusHasClass(e[t],"forbid")){var a=c(e[t].getAttribute("date-formate"));e[t].classList.remove("cus-calender_active"),e[t].classList.remove("cus-calender_compare_active"),e[t].classList.remove("cus-calender_including"),e[t].classList.remove("cus-calender_compare_including"),e[t].classList.remove("cus-start"),e[t].classList.remove("cus-end"),a==o.originDate[0]&&(e[t].className+=" cus-calender_active cus-start"),a==o.originDate[1]&&(e[t].className+=" cus-calender_active cus-end"),a>o.originDate[0]&&a<o.originDate[1]&&"normal"==e[t].getAttribute("type")&&(e[t].className+=" cus-calender_including"),o.is_compare&&(a==o.compareDate[0]&&(e[t].className+=" cus-calender_compare_active cus-start"),a==o.compareDate[1]&&(e[t].className+=" cus-calender_compare_active cus-end"),a>o.compareDate[0]&&a<o.compareDate[1]&&(e[t].className+=" cus-calender_compare_including"))}},cusDisplayCalender:function(e,t){var a=0,n=[];(e%4==0&&e%100!=0||e%400==0)&&(a=1);var c=[31,28+a,31,30,31,30,31,31,30,31,30,31],s=new Date(e,t-1,1).getDay(),i=6-new Date(e,t,0).getDay();if(s>0)for(var r=0;r<s;r++){var o={type:"disabled",classname:"forbid",cont:"",format:e+"-"+t};n.push(o)}for(var u=0;u<c[t-1];u++){var l={type:"normal",classname:"normal",cont:u+1,format:e+"-"+t+"-"+(u+1)};n.push(l)}if(i>0)for(var d=0;d<i;d++){var m={type:"disabled",classname:"forbid",cont:"",format:e+"-"+t};n.push(m)}return n},cusDrawCalender:function(e,t){var n=this,r=document.createElement("div"),u="";i[o.week].forEach(function(e,t){u+='<span class="cus-calender-header">'+e+"</span>"}),r.innerHTML="",this.cusDisplayCalender(e,t).forEach(function(e,t){var a="",n="";0==t&&(n='<h4 class="cus-calender-title" date-formate="'+e.format+'"></h4>',r.innerHTML+=n,r.innerHTML+='\n                    <div class="cus-panel-container-header cus-clearFix">\n                        '+u+"\n                    </div>\n                    <hr/>\n                ");var s=!1;c(new Date)<c(new Date(""+e.format))&&(s=!0),a='<span class="cus-calender-body '+e.classname+" cus-not-click-"+s+'" date-formate="'+e.format+'" type="'+e.type+'" not-allow="'+s+'"><i>'+e.cont+"</i></span>",r.innerHTML+=a});var l=!1,d=!1,m=parseInt(t)-1<1?parseInt(e)-1+"-12":e+"-"+(parseInt(t)-1),p=parseInt(e)-1+"-"+t,v=parseInt(t)+1>12?parseInt(e)+1+"-1":e+"-"+(parseInt(t)+1),_=parseInt(e)+1+"-"+t;c(new Date)<c(new Date(v+"-1"))&&(l=!0),c(new Date)<c(new Date(_+"-1"))&&(d=!0);var g='<button class="cus-prev-month" cus-date-prev="'+m+'"> < </button>',y='<button class="cus-prev-year" cus-date-prev="'+p+'"> << </button>',h='<button class="cus-next-month is-disable-'+l+'" cus-date-disabled="'+l+'" cus-date-next="'+v+'"> > </button>',f='<button class="cus-next-year is-disable-'+d+'" cus-date-disabled="'+d+'" cus-date-next="'+_+'"> >> </button>';if(this.cusGetElemenet({query_Selector:".cus-panel-body"}).getElementsByTagName("div")&&this.cusGetElemenet({query_Selector:".cus-panel-body"}).getElementsByTagName("div").length>1){var D=this.cusGetElemenet({query_Selector:".cus-panel-body"}).getElementsByTagName("div")[0];this.cusGetElemenet({query_Selector:".cus-panel-body"}).removeChild(D)}this.cusGetElemenet({query_Selector:".cus-panel-body"}).appendChild(r);var b=this.cusGetElemenet({query_Selector:".cus-calender-title"}),E=s(new Date(e+"-"+t),"{y}年{m}月");b.innerHTML=y+g+"<span>"+E+"</span>"+h+f;var S=this.cusGetElemenet({query_Selector:".cus-prev-month"}),C=this.cusGetElemenet({query_Selector:".cus-prev-year"}),k=this.cusGetElemenet({query_Selector:".cus-next-month"}),G=this.cusGetElemenet({query_Selector:".cus-next-year"});if(S&&S.addEventListener("click",function(e){var t=S.getAttribute("cus-date-prev"),a=t.split("-")[0],c=t.split("-")[1];n.cusDrawCalender(a,c),n.cusTriggerEvent()}),C&&C.addEventListener("click",function(e){var t=C.getAttribute("cus-date-prev"),a=t.split("-")[0],c=t.split("-")[1];n.cusDrawCalender(a,c),n.cusTriggerEvent()}),k&&k.addEventListener("click",function(e){if("false"==k.getAttribute("cus-date-disabled")){var t=k.getAttribute("cus-date-next"),a=t.split("-")[0],c=t.split("-")[1];n.cusDrawCalender(a,c),n.cusTriggerEvent()}}),G&&G.addEventListener("click",function(e){if("false"==G.getAttribute("cus-date-disabled")){var t=G.getAttribute("cus-date-next"),a=t.split("-")[0],c=t.split("-")[1];n.cusDrawCalender(a,c),n.cusTriggerEvent()}}),this.cusGetElemenet({class_Name:"cus-calender-body"})){for(var w=this.cusGetElemenet({class_Name:"cus-calender-body"}),L=0;L<w.length;L++)!function(e){w[e].addEventListener("click",function(t){a.$emit("cusChooseDate",e)})}(L);this.cusSelectedTime()}this.cusTriggerEvent()},cusQuickyKey:function(){var e=document.createElement("ul");e.className="cus-quicky-ul-key",o.OriginQuicky&&o.OriginQuicky.length>0&&(o.OriginQuicky.forEach(function(t,a){var n='<li class="cus-quicky-li-key">'+t.label+"</li>";e.innerHTML+=n}),this.cusGetElemenet({query_Selector:".cus-quicky-key"}).appendChild(e))},cusBindEvent:function(){var e=this;a.on("compareShowcompareShow",function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=e;if(t[0]){var c='\n                        <input type="text" cus-data-bind="compare_start_Date" id="cusCompareStartDate"/>\n                        <i>'+o.divider+'</i>\n                        <input type="text" cus-data-bind="compare_end_Date" id="cusCompareEndDate"/>\n                    ';e.cusGetElemenet({query_Selector:".cus-complate-date"})&&e.cusGetElemenet({query_Selector:".cus-show-calender"}).removeChild(e.cusGetElemenet({query_Selector:".cus-complate-date"})),e.cusGetElemenet({query_Selector:".cus-compate-select"})&&e.cusGetElemenet({query_Selector:".cus-compare-panel"}).removeChild(e.cusGetElemenet({query_Selector:".cus-compate-select"}));var s=document.createElement("div");s.className="cus-complate-date";var i=document.createElement("span");i.className="cus-compate-select",s.innerHTML=c,i.innerHTML='\n                        <select name="" id="cusChooseCompareSelect">\n                            <option value="last_time_period" selected>上一个时间段</option>\n                            <option value="last_week_ago">一周前</option>\n                            <option value="last_month_ago">一个月前</option>\n                            <option value="three_months_ago">三个月前</option>\n                            <option value="half_a_year_ago">半年前</option>\n                            <option value="a_year_ago">一年前</option>\n                            <option value="custom_date">自定义</option>\n                        </select>',e.cusGetElemenet({query_Selector:".cus-show-calender"}).appendChild(s),e.cusGetElemenet({query_Selector:".cus-compare-panel"}).appendChild(i);var u=e.cusGetElemenet({query_Selector:"#cusCompareStartDate"}),l=e.cusGetElemenet({query_Selector:"#cusOriginStartDate"}),d=e.cusGetElemenet({query_Selector:"#cusCompareEndDate"}),m=e.cusGetElemenet({query_Selector:"#cusChooseCompareSelect"}),p=m.options[m.selectedIndex].value;a.$emit("cusGetSelectDate",p),r[u.getAttribute("cus-data-bind")].bindTo(u),r[d.getAttribute("cus-data-bind")].bindTo(d),r[u.getAttribute("cus-data-bind")].set(o.compare_Date[0]),r[d.getAttribute("cus-data-bind")].set(o.compare_Date[1]),m&&m.addEventListener("change",function(e){a.$emit("cusGetSelectDate",m.options[m.selectedIndex].value),p&&"custom_date"==p?(o.start_cycle=2,u.focus()):o.start_cycle>2&&(o.start_cycle=0,l.focus())}),u&&u.addEventListener("input",function(){r[this.getAttribute("cus-data-bind")].set(this.value)}),u&&u.addEventListener("keyup",function(e){"13"==e.keyCode&&n.setCompareDate(u.value,0)}),d&&d.addEventListener("input",function(){r[this.getAttribute("cus-data-bind")].set(this.value)}),d&&d.addEventListener("keyup",function(e){"13"==e.keyCode&&n.setCompareDate(d.value,1)}),u&&u.addEventListener("focus",function(e){a.$emit("cusSelectedOptions",{$select:m,$value:"custom_date"}),o.start_cycle=2}),d&&d.addEventListener("focus",function(e){a.$emit("cusSelectedOptions",{$select:m,$value:"custom_date"}),o.start_cycle=3}),e.cusSelectedTime()}else e.cusGetElemenet({query_Selector:".cus-complate-date"})&&e.cusGetElemenet({query_Selector:".cus-show-calender"}).removeChild(e.cusGetElemenet({query_Selector:".cus-complate-date"})),e.cusGetElemenet({query_Selector:".cus-compate-select"})&&e.cusGetElemenet({query_Selector:".cus-compare-panel"}).removeChild(e.cusGetElemenet({query_Selector:".cus-compate-select"})),e.cusSelectedTime()}),a.on("cusGetSelectDate",function(){switch((arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")[0]){case"last_time_period":e.setCompareDate([2*o.originDate[0]-o.originDate[1]-864e5,o.originDate[0]-864e5]);break;case"last_week_ago":e.setCompareDate([o.originDate[0]-6048e5,o.originDate[1]-6048e5]);break;case"last_month_ago":e.setCompareDate([o.originDate[0]-2592e6,o.originDate[1]-2592e6]);break;case"three_months_ago":e.setCompareDate([o.originDate[0]-7776e6,o.originDate[1]-7776e6]);break;case"half_a_year_ago":e.setCompareDate([o.originDate[0]-15552e6,o.originDate[1]-15552e6]);break;case"a_year_ago":e.setCompareDate([o.originDate[0]-31536e6,o.originDate[1]-31536e6])}}),a.on("cusChooseDate",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=e.cusGetElemenet({id_Name:"cusOriginStartDate"}),n=e.cusGetElemenet({id_Name:"cusOriginEndDate"}),c=e.cusGetElemenet({class_Name:"cus-calender-body"});if("normal"!=c[t].getAttribute("type")||"true"==c[t].getAttribute("not-allow"))return!1;var s=document.querySelector("#cusChooseCompareSelect"),i=void 0;if(s&&(i=s.options[s.selectedIndex].value),o.is_compare&&i&&"custom_date"==i){var r=e.cusGetElemenet({id_Name:"cusCompareStartDate"}),u=e.cusGetElemenet({id_Name:"cusCompareEndDate"});o.start_cycle<2?e.setOriginDate(c[t].getAttribute("date-formate"),o.start_cycle):e.setCompareDate(c[t].getAttribute("date-formate"),o.start_cycle-2),o.start_cycle>=4&&(o.start_cycle=0),1==o.start_cycle?n.focus():2==o.start_cycle?r.focus():3==o.start_cycle?u.focus():a.focus()}else e.setOriginDate(c[t].getAttribute("date-formate"),o.start_cycle),1==o.start_cycle?n.focus():a.focus(),o.start_cycle>=2&&(o.start_cycle=0)}),a.on("cusSetQuickDate",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];String(t)&&(t=String(t).split(",")),e.setOriginDate([Number(t[0]),Number(t[1])])}),a.on("cusSelectedOptions",function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0;t<e[0].$select.options.length;t++)if(e[0].$select.options[t].value==e[0].$value){e[0].$select.options[t].selected=!0;break}})},cusTriggerEvent:function(){var e=this.cusGetElemenet({query_Selector:".cus-show-calender"}),t=this.cusGetElemenet({query_Selector:".cus-calender-panel"});if(e&&e.addEventListener("click",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,t.style.display=""}),t&&t.addEventListener("click",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,t.style.display=""}),document.addEventListener("click",function(e){t.style.display="none"}),this.cusGetElemenet({class_Name:"cus-quicky-li-key"}))for(var n=this.cusGetElemenet({class_Name:"cus-quicky-li-key"}),c=0;c<n.length;c++)!function(e){n[e].onclick=function(){this.index=e,o.OriginQuicky[this.index].callback(a)}}(c);if(this.cusGetElemenet({id_Name:"compare-panel-input-show"})){var s=this.cusGetElemenet({id_Name:"compare-panel-input-show"});s.addEventListener("click",function(e){s.checked?o.is_compare=!0:o.is_compare=!1,a.$emit("compareShowcompareShow",o.is_compare)})}},cusGetElemenet:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id_Name:"",class_Name:"",tag_Name:"",query_Selector:""};return e.id_Name?document.getElementById(e.id_Name):e.class_Name?document.getElementsByClassName(e.class_Name):e.tag_Name?document.getElementsByTagName(e.tag_Name):e.query_Selector?document.querySelector(e.query_Selector):void 0},cusHasClass:function(e,t){for(var a=e.className.split(/\s+/),n=0;n<a.length;n++)if(a[n]===t)return!0;return!1},setOriginDate:function(){var e=!1;if(2==arguments.length){var t=arguments[1],n=arguments[0];c(n)==o.originDate[0]?o.originDate[1]=c(n):o.originDate.splice(t,1,c(n)),1==t&&(e=!0),o.originDate[1]<o.originDate[0]?o.originDate.reverse():o.start_cycle++}else{var i=arguments[0];o.originDate=[c(i[0]),c(i[1])],e=!0}o.origin_Date=[s(o.originDate[0]),s(o.originDate[1])],r.origin_start_Date.set(o.origin_Date[0]),r.origin_end_Date.set(o.origin_Date[1]),e&&this.cusDrawCalender(o.origin_Date[1].split("-")[0],o.origin_Date[1].split("-")[1]);var u=this.cusGetElemenet({query_Selector:"#cusChooseCompareSelect"}),l=void 0;u&&(l=u.options[u.selectedIndex].value),o.is_compare&&l&&"custom_date"!=l&&a.$emit("cusGetSelectDate",l),this.cusSelectedTime()},setCompareDate:function(){if(2==arguments.length){var e=arguments[1],t=arguments[0];c(t)==o.compareDate[0]?o.compareDate[1]=c(t):o.compareDate.splice(e,1,c(t)),o.compareDate[0]>o.compareDate[1]?o.compareDate=o.compareDate.reverse():o.start_cycle++}else{var a=arguments[0];o.compareDate=[c(a[0]),c(a[1])]}o.compare_Date=[s(o.compareDate[0]),s(o.compareDate[1])],r.compare_start_Date.set(o.compare_Date[0]),r.compare_end_Date.set(o.compare_Date[1]),this.cusSelectedTime()}},{cusDate:e}}();